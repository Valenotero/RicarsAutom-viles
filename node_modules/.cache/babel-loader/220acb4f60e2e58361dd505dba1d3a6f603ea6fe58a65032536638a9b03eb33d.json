{"ast":null,"code":"import{supabase}from'../supabase/config';// Generar ID único para visitantes no autenticados\nconst generateVisitorId=()=>{let visitorId=localStorage.getItem('gallery_visitor_id');if(!visitorId){visitorId='visitor_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);localStorage.setItem('gallery_visitor_id',visitorId);}return visitorId;};// Incrementar vista de un elemento de galería\nexport const incrementGalleryView=async galleryId=>{try{const visitorId=generateVisitorId();const{data,error}=await supabase.rpc('increment_gallery_views',{gallery_uuid:galleryId,visitor_identifier:visitorId});if(error){console.error('Error incrementando vista de galería:',error);return false;}return data;// Retorna true si se incrementó, false si ya existía\n}catch(error){console.error('Error incrementando vista de galería:',error);return false;}};// Obtener estadísticas de vistas de galería\nexport const getGalleryViewsStats=async()=>{try{const{data,error}=await supabase.rpc('get_gallery_views_stats');if(error)throw error;return data[0]||{total_views:0,total_items:0,avg_views_per_item:0,total_unique_visitors:0};}catch(error){console.error('Error obteniendo estadísticas de galería:',error);return{total_views:0,total_items:0,avg_views_per_item:0,total_unique_visitors:0};}};// Obtener elementos más vistos\nexport const getMostViewedGalleryItems=async function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;try{const{data,error}=await supabase.rpc('get_most_viewed_gallery_items',{limit_count:limit});if(error)throw error;return data||[];}catch(error){console.error('Error obteniendo elementos más vistos:',error);return[];}};// Verificar si un usuario ya vio un elemento específico\nexport const hasViewedGalleryItem=async galleryId=>{try{const visitorId=generateVisitorId();const{data:{user}}=await supabase.auth.getUser();let query=supabase.from('gallery_views').select('id').eq('gallery_id',galleryId);if(user){query=query.eq('user_id',user.id);}else{query=query.eq('visitor_id',visitorId);}const{data,error}=await query.single();if(error&&error.code!=='PGRST116'){throw error;}return!!data;}catch(error){console.error('Error verificando vista de galería:',error);return false;}};// Obtener elementos de galería con contadores de vistas\nexport const getGalleryItemsWithViews=async()=>{try{const{data,error}=await supabase.from('gallery').select('*').order('created_at',{ascending:false});if(error)throw error;return data||[];}catch(error){console.error('Error obteniendo elementos de galería:',error);return[];}};","map":{"version":3,"names":["supabase","generateVisitorId","visitorId","localStorage","getItem","Date","now","Math","random","toString","substr","setItem","incrementGalleryView","galleryId","data","error","rpc","gallery_uuid","visitor_identifier","console","getGalleryViewsStats","total_views","total_items","avg_views_per_item","total_unique_visitors","getMostViewedGalleryItems","limit","arguments","length","undefined","limit_count","hasViewedGalleryItem","user","auth","getUser","query","from","select","eq","id","single","code","getGalleryItemsWithViews","order","ascending"],"sources":["C:/Users/otero/OneDrive/Escritorio/Paginas Web/ri cars automotores/src/services/galleryViewsService.js"],"sourcesContent":["import { supabase } from '../supabase/config';\r\n\r\n// Generar ID único para visitantes no autenticados\r\nconst generateVisitorId = () => {\r\n  let visitorId = localStorage.getItem('gallery_visitor_id');\r\n  if (!visitorId) {\r\n    visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n    localStorage.setItem('gallery_visitor_id', visitorId);\r\n  }\r\n  return visitorId;\r\n};\r\n\r\n// Incrementar vista de un elemento de galería\r\nexport const incrementGalleryView = async (galleryId) => {\r\n  try {\r\n    const visitorId = generateVisitorId();\r\n    \r\n    const { data, error } = await supabase\r\n      .rpc('increment_gallery_views', {\r\n        gallery_uuid: galleryId,\r\n        visitor_identifier: visitorId\r\n      });\r\n\r\n    if (error) {\r\n      console.error('Error incrementando vista de galería:', error);\r\n      return false;\r\n    }\r\n\r\n    return data; // Retorna true si se incrementó, false si ya existía\r\n  } catch (error) {\r\n    console.error('Error incrementando vista de galería:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Obtener estadísticas de vistas de galería\r\nexport const getGalleryViewsStats = async () => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .rpc('get_gallery_views_stats');\r\n\r\n    if (error) throw error;\r\n    return data[0] || { \r\n      total_views: 0, \r\n      total_items: 0, \r\n      avg_views_per_item: 0, \r\n      total_unique_visitors: 0 \r\n    };\r\n  } catch (error) {\r\n    console.error('Error obteniendo estadísticas de galería:', error);\r\n    return { \r\n      total_views: 0, \r\n      total_items: 0, \r\n      avg_views_per_item: 0, \r\n      total_unique_visitors: 0 \r\n    };\r\n  }\r\n};\r\n\r\n// Obtener elementos más vistos\r\nexport const getMostViewedGalleryItems = async (limit = 10) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .rpc('get_most_viewed_gallery_items', { limit_count: limit });\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (error) {\r\n    console.error('Error obteniendo elementos más vistos:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Verificar si un usuario ya vio un elemento específico\r\nexport const hasViewedGalleryItem = async (galleryId) => {\r\n  try {\r\n    const visitorId = generateVisitorId();\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    \r\n    let query = supabase\r\n      .from('gallery_views')\r\n      .select('id')\r\n      .eq('gallery_id', galleryId);\r\n\r\n    if (user) {\r\n      query = query.eq('user_id', user.id);\r\n    } else {\r\n      query = query.eq('visitor_id', visitorId);\r\n    }\r\n\r\n    const { data, error } = await query.single();\r\n\r\n    if (error && error.code !== 'PGRST116') {\r\n      throw error;\r\n    }\r\n\r\n    return !!data;\r\n  } catch (error) {\r\n    console.error('Error verificando vista de galería:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Obtener elementos de galería con contadores de vistas\r\nexport const getGalleryItemsWithViews = async () => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('gallery')\r\n      .select('*')\r\n      .order('created_at', { ascending: false });\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (error) {\r\n    console.error('Error obteniendo elementos de galería:', error);\r\n    return [];\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}